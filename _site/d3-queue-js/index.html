<!DOCTYPE html>
<html>
<head>
  <title>GISCollective</title>
  <meta http-equiv="content-type" charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href='http://fonts.googleapis.com/css?family=Roboto+Slab:300,400,700' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Roboto:100,300,600,900' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Droid+Sans+Mono' rel='stylesheet' type='text/css'>
  <link href="/public/style.css" rel="stylesheet">
</head>
<body>
  <div id="navbar">
  <div class="wrapper">
    <div id="branding">
      <div id="site-title"><h1><a href="/" title="GISC" rel="home">GISC</a></h1></div>
    </div>
    <nav id="nav">
      <button class="nav-expand"><i class="icon hamburger"></i></button>
      <ul id="menu-gisc-2" class="menu">
        <li id="menu-item-111" class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home menu-item-111"><a href="/">Home</a></li>
        <li id="menu-item-101" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-101"><a href="/tutorials/">Tutorials</a></li>
        <li id="menu-item-192" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-192"><a href="/resources/">Resources</a></li>
        <li id="menu-item-108" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-108"><a href="/about/">About</a></li>
      </ul>
    </nav>
  </div>
</div>
  <div class="wrapper hfeed">
  <div id="container">

<article id="content">
  <div class="post type-post status-publish format-standard hentry category-data">
    <h2 class="entry-title">
      <a href="/d3-queue-js/" title="D3: Queue.js" rel="bookmark">D3: Queue.js</a>
    </h2>

    <div class="entry-content">
      <div class="entry-meta">
  <span class="meta-prep meta-prep-author">By </span>
  <span class="author"><a class="url fn n" href="/Sam Matthews" title="View all articles by Irina Papuc">Sam Matthews</a></span>
  <span class="meta-sep"> | </span>
  <span class="meta-prep meta-prep-entry-date">Published </span>
  <span class="entry-date"><abbr class="published" title="2016-01-05T16:50:01-0500">2013-08-08 03:00:24 -0700</abbr></span>
</div>

<table>
  <tbody>
    <tr>
      <td><a href="http://giscollective.org/d3">D3 Tutorial</a>: Example 006 ( <a href="http://bl.ocks.org/svmatthews/6090056">bl.ock</a></td>
      <td><a href="https://gist.github.com/svmatthews/6090056">gist</a> )</td>
    </tr>
  </tbody>
</table>

<p>D3 often requires large geodata files that can be a burden to load for your browser. Some action has been taken to reduce file sizes (the creation of topojson) but sometimes you just have a dataset that is as small as it can get, yet still pretty large. If you’ve run into this problem, you may have noticed your D3 code running before your file has actually loaded, which pooches the whole thing. [<em>Enter <a href="https://github.com/mbostock/queue">Queue.js</a></em>] Queue is a lightweight asynchronous helper library. Their words, not mine). To put it nicely:</p>

<blockquote>
  <p>Queue is a plugin that loads external files into the script and ensures each file is completely loaded before allowing the script to continue running.</p>
</blockquote>

<p>It is especially useful to use when you are loading multiple datasets into your code. In the following example, we’ll load two files; one a topojson of US States and one a geojson of US Populated cities. Note it isn’t terribly important to convert the point data to topojson because it is inherently as simple as it can get since point data is uni-dimensional.</p>

<p>Remember to load the queue.js library <strong>after</strong> your d3 library:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;script src="http://d3js.org/queue.v1.min.js"&gt;&lt;/script&gt;
</code></pre>
</div>

<p>Queue has a few parts:</p>

<ul>
  <li><code class="highlighter-rouge">queue()</code> – initializes Queue.js and your loading queue &lt;/span&gt;</li>
  <li><code class="highlighter-rouge">defer()</code> – used for each file to allow them to load separately</li>
  <li><code class="highlighter-rouge">await()</code> – the final piece, which typically runs a function once the data are loaded</li>
</ul>

<p><strong>The Queue</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>queue()
    .defer(d3.json, 'states.json') // topojson polygons
    .defer(d3.json, 'cities.json') // geojson points
    .await(makeMyMap); // function that uses files
</code></pre>
</div>

<p><strong>Call Function</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>function makeMyMap(error, states, cities) {
    svg.append('path')
        .datum(topojson.feature(states, states.objects.usStates))
        .attr('d', path)
        .attr('class', 'states');
    svg.selectAll('.cities')
        .data(cities.features)
        .enter()
        .append('path')
        .attr('d', path.pointRadius(5))
        .attr('class', 'cities');
}
</code></pre>
</div>

<p>This loads multiple files before the code is run to preserve any actions or transitions your data may take before they load.</p>

    </div>
  </div>
</article>

<aside id="sidebar">
  <p id="site-description">Collective spatial learning from students and professionals</p>
  <div id="primary" class="widget-area">

    <h3 class="widget-title">Categories</h3>
    <ul>
      <li>list of categories</li>
    </ul>

    <h3 class="widget-title">Recent posts</h3>
    <ul>
      <li>list of recent posts</li>
    </ul>

    <h3 class="widget-title">Archives</h3>
    <ul>
      <li>something that resembles the archives</li>
    </ul>
  </div>
</aside>

<div class="clear"></div>
</div>
<footer>
<div id="copyright">GISCollective.org, 2016</div>
</footer>
</div>
<script src="/public/gisc.js"></script>
</body>
</html>